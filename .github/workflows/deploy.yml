name: Simple EC2 Deploy

on:
  push:
    branches:
      - master  # or master, depending on your default branch name

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Deploy to EC2
        env:
          PRIVATE_KEY: ${{ secrets.EC2_SSH_PRIVATE_KEY }}
          HOST: ec2-18-198-2-85.eu-central-1.compute.amazonaws.com
          USER: ubuntu
        run: |
          echo "$PRIVATE_KEY" > private_key && chmod 600 private_key
          ssh -o StrictHostKeyChecking=no -i private_key ${USER}@${HOST} '
            cd ~/go-app-deploy &&
            git pull origin master &&
            go build -o app &&
            ./app &
          '